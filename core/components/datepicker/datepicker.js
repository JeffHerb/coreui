/*! Core UI
 *  @description  Core UI Frontend Framework
 *  @version      0.0.1.REL20150213
 *  @copyright    2015 New York State Finance, Regulation & Gaming Cluster
 */

cui.namespace("datepicker",cui.component),cui.component.datepicker=function(){var $body,$window,MONTH_EN=["January","February","March","April","May","June","July","August","September","October","November","December"],MSHORT_EN=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],DAYS_WK_EN=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],DAYS_MON=[31,28,31,30,31,30,31,31,30,31,30,31],CULTURES={USA:{mask:"MM|DD|YYYY",delim:"/"},INT:{mask:"DD|MM|YYYY",delim:"/"},SYS:{mask:"YYYY|MM|DD",delim:"-"}},CLASSES={hidden:"hidden",selected:"selected",invalidDate:"invalidDate"},SELECTORS={icon:".calendar"},ID_PREFIXES={datePicker:"datePicker_",calIcon:"cal_",selectedMonth:"selMon_",selectedYear:"selYr_"},ICON_TOOLTIP={show:"Open the calendar popup",hide:"Close the calendar popup"},OPTIONS_TOOLTIP={show:"Open options",hide:"Close options"},_priv={},_events={},_imgPath=cui.environment.getImagesPath("components")+"datepicker/",_defaultSettings={datePickers:[{inputId:"",culture:"USA",minDate:"01/01/1950",maxDate:"12/31/2150",display:{theme:0,autoError:!1,enableBoundaryDetection:!0}}]},_mySettings={datePickers:[]},_init=function(){$body=$("body"),$window=$(window),$body.on("click",SELECTORS.icon,_events._iconClick),$(SELECTORS.icon).each(function(){var $icon=$(this),$input=$("#"+this.id.substring(this.id.indexOf(ID_PREFIXES.calIcon)+4));$input.length&&$input.on("blur",_events._inputBlur),$icon.attr("title",ICON_TOOLTIP.show)})},_setImagesPath=function(url){url&&"string"==typeof url&&$.trim(url).length>0&&(_imgPath=url)},_customize=function(settings){var dp,i,j,k,minDefaultDate=new Date(_defaultSettings.datePickers[0].minDate),maxDefaultDate=new Date(_defaultSettings.datePickers[0].maxDate);if(settings&&"object"==typeof settings)for(i=settings.datePickers.length;i>j;)dp=settings.datePickers[j],dp&&dp.inputId&&$.trim(dp.inputId).length>0&&(dp.display||(dp.display={}),_mySettings.datePickers[k]={inputId:dp.inputId,culture:dp.culture||_defaultSettings.datePickers[0].culture,minDate:dp.minDate||_priv._setDateToCulture({day:minDefaultDate.getDate(),month:minDefaultDate.getMonth()+1,year:minDefaultDate.getFullYear()},dp.inputId,CULTURES[dp.culture]),maxDate:dp.maxDate||_priv._setDateToCulture({day:maxDefaultDate.getDate(),month:maxDefaultDate.getMonth()+1,year:maxDefaultDate.getFullYear()},dp.inputId,CULTURES[dp.culture]),display:{theme:dp.display.theme||_defaultSettings.datePickers[0].display.theme,autoError:dp.display.autoError||_defaultSettings.datePickers[0].display.autoError,enableBoundaryDetection:dp.display.enableBoundaryDetection||_defaultSettings.datePickers[0].display.enableBoundaryDetection}},k+=1),j+=1},_hideAll=function(){_priv._hideAllDatePickers()};return _priv._getSettings=function(inputId){var i=_mySettings.datePickers.length;if(0===i)return _defaultSettings.datePickers[0];for(;(i-=1)>=0;)if(_mySettings.datePickers[i].inputId===inputId)return _mySettings.datePickers[i];return _defaultSettings.datePickers[0]},_priv._showHideDatePicker=function(calIcon,cal,forceHide){var inputId=calIcon.id.substring(calIcon.id.indexOf(ID_PREFIXES.calIcon)+4);forceHide=forceHide||!1,cal?$(cal).hasClass(CLASSES.hidden)&&!forceHide?(cal=_priv._refreshDatePickerHtml(cal),_priv._setDatePickerPosition(cal),_priv._showDatePicker(cal),_priv._getSettings(inputId).display.enableBoundaryDetection&&_priv._handleBoundaryDetection(cal),$("#dpCalWrap_"+inputId).focus()):(_priv._hideDatePicker(cal),$(calIcon).focus()):(cal=_priv._createDatePicker(calIcon),_priv._setDatePickerPosition(cal),_priv._getSettings(inputId).display.enableBoundaryDetection&&_priv._handleBoundaryDetection(cal),$("#dpCalWrap_"+inputId).focus(),calIcon.title=ICON_TOOLTIP.hide,$body.on("click",_events._bodyClick),$window.on("resize",_events._windowResize))},_priv._createDatePicker=function(elem){var inputId=elem.id.substring(elem.id.indexOf(ID_PREFIXES.calIcon)+4),$cal=$("<div/>");return $cal.attr("id",ID_PREFIXES.datePicker+inputId).attr("style","inline-block").addClass("dp").html(_priv._getDatePickerHtml(_priv._getDatePickerInitialDate(inputId),inputId)),$body.append($cal),$body.on("click",".dp",_events._calClick).on("dblclick",".dp",_events._calClick).on("keydown",".dp",_events._calKeydown),$cal.get(0)},_priv._refreshDatePickerHtml=function(cal){var inputId=cal.id.substring(cal.id.indexOf(ID_PREFIXES.datePicker+"_")+(ID_PREFIXES.datePicker.length+1));return cal.innerHTML=_priv._getDatePickerHtml(_priv._getDatePickerInitialDate(inputId),inputId),cal},_priv._getDatePickerHtml=function(dmyCal,inputId){var html="",calDate=null,weekday=-1,lastDayMonth=0,lastDayPrevMonth=0,prevMon=0,prevYr=0,nextMon=0,nextYr=0,i=0,rows=0,daysCnt=0,titleDate=null,today=new Date,__getDayTitle=function(date){return DAYS_WK_EN[date.getDay()]+", "+MONTH_EN[date.getMonth()]+" "+date.getDate()+", "+date.getFullYear()};for(dmyCal=_priv._convertDMYToNumeric(dmyCal),html+='<div id="dpCalWrap_'+inputId+'" class="dpCalWrap" tabindex="1"><div class="dpCal">',html+=_priv._getHeaderHtml(dmyCal,inputId),html+='<div class="dpBody"><div class="dpDayDesc"><ul><li>S</li><li>M</li><li>T</li><li>W</li><li>T</li><li>F</li><li>S</li></ul></div><div class="dpWeekNbrDays">',html+='<div class="dpDays"><ul>',calDate=new Date(dmyCal.month.toString()+"/01/"+dmyCal.year.toString()),weekday=calDate.getDay(),lastDayMonth=_priv._getLastDayOfMonth(calDate),nextMon=dmyCal.month+1,nextYr=dmyCal.year,1===dmyCal.month?(prevMon=12,prevYr=dmyCal.year-1):(prevMon=dmyCal.month-1,prevYr=dmyCal.year,nextMon>12&&(nextMon=1,nextYr+=1)),lastDayPrevMonth=_priv._getLastDayOfMonth(new Date(prevMon+"/01/"+prevYr)),0===weekday&&(weekday=7);weekday>0;)daysCnt+=1,html+='<li class="prevMonthDay',0===i&&(html+=" newLine",rows+=1,i+=1),titleDate=new Date(prevMon+"/"+(lastDayPrevMonth-weekday+1)+"/"+prevYr),html+=_priv._validateMinMaxRange({day:lastDayPrevMonth-weekday+1,month:prevMon,year:prevYr},inputId)?'"><a href="#" role="button" title="'+__getDayTitle(titleDate)+'" tabindex="1">'+(lastDayPrevMonth-weekday+1)+"</a></li>":'"><span class="disabled">'+(lastDayPrevMonth-weekday+1)+"</span></li>",weekday-=1;for(i=0;lastDayMonth>i;)daysCnt+=1,html+='<li class="',8===daysCnt&&(html+="newLine",rows+=1,daysCnt=1),today.getDate()===i+1&&today.getMonth()===dmyCal.month-1&&today.getFullYear()===dmyCal.year&&(html+=" today"),dateParsed=_priv._processDate($.trim(document.getElementById(inputId).value),inputId),dateParsed.valid&&parseInt(dateParsed.dmy.day,10)===i+1&&parseInt(dateParsed.dmy.month,10)===dmyCal.month&&parseInt(dateParsed.dmy.year,10)===dmyCal.year&&(html+=" selectedDay"),titleDate=new Date(dmyCal.month.toString()+"/"+(i+1)+"/"+dmyCal.year.toString()),html+=_priv._validateMinMaxRange({day:i+1,month:dmyCal.month,year:dmyCal.year},inputId)?'"><a href="#" role="button" title="'+__getDayTitle(titleDate)+'" tabindex="1">'+(i+1)+"</a></li>":'"><span class="disabled">'+(i+1)+"</span></li>",i+=1;for(i=0,7===daysCnt&&(daysCnt=0);7>daysCnt;)html+='<li class="nextMonthDay',0===daysCnt&&(html+=" newLine",rows+=1),titleDate=new Date(nextMon+"/"+(i+1)+"/"+nextYr),html+=_priv._validateMinMaxRange({day:i+1,month:nextMon,year:nextYr},inputId)?'"><a href="#" role="button" title="'+__getDayTitle(titleDate)+'" tabindex="1">'+(i+1)+"</a></li>":'"><span class="disabled">'+(i+1)+"</span></li>",daysCnt+=1,i+=1,7===daysCnt&&6>rows&&(daysCnt=0);return i=0,html+='</ul></div></div><div class="dpFoot"></div></div></div>',html+="</div>",html+='<div id="dpOptions_'+inputId+'" class="dpOptWrap '+CLASSES.hidden+'" tabindex="1">',html+='<div class="dpOpt"><div class="dpMon">'+_priv._setOptionsMonths(dmyCal,inputId)+"</div>",html+='<div class="dpYr">'+_priv._setOptionsYears(dmyCal,inputId)+"</div>",html+='<div id="dpOther_'+inputId+'" class="dpOther"><div class="dpOtherL"><a href="#" role="button" title="Today" tabindex="1">Today</a></div><div class="dpOtherR"><a href="#" role="button" id="dpOK_'+inputId+'" title="OK" tabindex="1">OK</a><a href="#" role="button" title="Cancel" tabindex="1">Cancel</a></div></div>',html+="</div></div>"},_priv._getHeaderHtml=function(dmyCal,inputId){var html="",settings=_priv._getSettings(inputId),minDate=_priv._parseDateStringToDateObject(settings.minDate,inputId),maxDate=_priv._parseDateStringToDateObject(settings.maxDate,inputId);return html='<div class="dpHead">',html+=dmyCal.month===minDate.getMonth()+1&&dmyCal.year===minDate.getFullYear()?'<ul class="lIcons"><li><span class="grayedOut"><img src="'+_imgPath+'CalendarPreviousQuarter.png" alt="Previous quarter"></span></li><li><span class="grayedOut"><img src="'+_imgPath+'CalendarPreviousMonth.png" alt="Previous month"></span></li></ul>':'<ul class="lIcons"><li><a href="#" class="fastNavPrevQtr" title="Previous quarter" tabindex="1"><img src="'+_imgPath+'CalendarPreviousQuarter.png" alt="Previous quarter"></a></li><li><a href="#" class="navPrevMon" title="Previous month" tabindex="1"><img src="'+_imgPath+'CalendarPreviousMonth.png" alt="Previous month"></a></li></ul>',html+='<div class="title"><a href="#" class="monthYear" title="'+OPTIONS_TOOLTIP.show+'" tabindex="1">'+MONTH_EN[dmyCal.month-1]+" "+dmyCal.year.toString()+'</a><input type="hidden" id="dpSel_'+inputId+'" value="'+dmyCal.month.toString()+"/"+dmyCal.year.toString()+'"></div>',html+=dmyCal.month===maxDate.getMonth()+1&&dmyCal.year===maxDate.getFullYear()?'<ul class="rIcons"><li><span class="grayedOut"><img src="'+_imgPath+'CalendarNextMonth.png" alt="Next month"></span></li><li><span class="grayedOut"><img src="'+_imgPath+'CalendarNextQuarter.png" alt="Next quarter"></span></li></ul>':'<ul class="rIcons"><li><a href="#" class="navNextMon" title="Next month" tabindex="1"><img src="'+_imgPath+'CalendarNextMonth.png" alt="Next month"></a></li><li><a href="#" class="fastNavNextQtr" title="Next quarter" tabindex="1"><img src="'+_imgPath+'CalendarNextQuarter.png" alt="Next quarter"></a></li></ul>',html+="</div>"},_priv._setDatePickerPosition=function(cal){var offset,inputId=cal.id.substring(cal.id.indexOf(ID_PREFIXES.datePicker+"_")+(ID_PREFIXES.datePicker.length+1)),input=document.getElementById(inputId),inputParent=null,coord=[],borderTop=0,borderBottom=0;input&&(inputParent=input.parentNode,inputParent.style.position="relative",offset=$(inputParent).offset(),coord=[offset.left,offset.top],cal.style.left=coord[0]+"px",borderTop=parseInt($(input).css("border-top-width"),10),borderBottom=parseInt($(input).css("border-bottom-width"),10),cal.style.top=coord[1]+input.clientHeight+borderTop+borderBottom+input.offsetTop+"px")},_priv._showDatePicker=function(cal){var inputId=cal.id.substring(cal.id.indexOf(ID_PREFIXES.calIcon+"_")+(ID_PREFIXES.calIcon.length+1));$(cal).removeClass(CLASSES.hidden),$("#"+ID_PREFIXES.calIcon+inputId).attr("title",ICON_TOOLTIP.hide),$body.on("click",_events._bodyClick),$window.on("resize",_events._windowResize)},_priv._hideDatePicker=function(cal){var inputId=cal.id.substring(cal.id.indexOf(ID_PREFIXES.calIcon+"_")+(ID_PREFIXES.calIcon.length+1));$(cal).addClass(CLASSES.hidden),$("#"+ID_PREFIXES.calIcon+inputId).attr("title",ICON_TOOLTIP.show)},_priv._hideAllDatePickers=function(inputId){inputId&&"string"==typeof inputId||(inputId=""),$("div.dp").each(function(){var $cal=$(this);this.id!==ID_PREFIXES.datePicker+inputId&&($cal.hasClass(CLASSES.hidden)||($cal.addClass(CLASSES.hidden),document.getElementById(ID_PREFIXES.calIcon+this.id.substring(this.id.indexOf(ID_PREFIXES.datePicker+"_")+(ID_PREFIXES.datePicker.length+1))).title=ICON_TOOLTIP.show))}),$body.off("click",_events._bodyClick),$window.off("resize",_events._windowResize)},_priv._showHideOptions=function(elem,opts,forceHide){var inputId=opts.id.substring(opts.id.indexOf("_")+1),$opts=$(opts),cal=document.getElementById(ID_PREFIXES.datePicker+inputId),monthYear=_priv._getMonthYearFromCalHeader(cal);forceHide=forceHide||!1,$opts.hasClass(CLASSES.hidden)&&!forceHide?(document.getElementById(ID_PREFIXES.selectedMonth+inputId).value=monthYear[0],document.getElementById(ID_PREFIXES.selectedYear+inputId).value=monthYear[1],$opts.find("div.dpMon").html(_priv._setOptionsMonths(_priv._convertDMYToNumeric({day:1,month:monthYear[0],year:monthYear[1]}),inputId)),$opts.find("div.dpYr").html(_priv._setOptionsYears(_priv._convertDMYToNumeric({day:1,month:monthYear[0],year:monthYear[1]}),inputId)),_priv._positionOptions(elem,opts),elem.title=OPTIONS_TOOLTIP.hide,_priv._showOptions(opts),_priv._getSettings(inputId).display.enableBoundaryDetection&&_priv._handleBoundaryDetection(opts),$opts.focus()):(elem.title=OPTIONS_TOOLTIP.show,_priv._hideOptions(opts),$(elem).focus())},_priv._setOptionsSelectedMonth=function(elem,opts,cal){var inputId=cal.id.substring(cal.id.indexOf(ID_PREFIXES.datePicker+"_")+(ID_PREFIXES.datePicker.length+1)),selMonth=document.getElementById(ID_PREFIXES.selectedMonth+inputId);$(opts).find("a, span.disabled").each(function(){$(this).parent().removeClass(CLASSES.selected)}),$(elem).parent().addClass(CLASSES.selected),selMonth.value=_priv._getMonthValFromShortStr(elem.innerHTML)},_priv._setOptionsSelectedYear=function(elem,opts,cal){var yr=elem.innerHTML,inputId=cal.id.substring(cal.id.indexOf(ID_PREFIXES.datePicker+"_")+(ID_PREFIXES.datePicker.length+1)),selMonth=document.getElementById(ID_PREFIXES.selectedMonth+inputId),selYear=document.getElementById(ID_PREFIXES.selectedYear+inputId),divMonths=$("#dpOptions_"+inputId+" div.dpMon").get(0);$(opts).find("a").each(function(){$(this).parent().removeClass(CLASSES.selected)}),$(elem).parent().addClass(CLASSES.selected),selYear.value=yr,divMonths.innerHTML=_priv._setOptionsMonths(_priv._convertDMYToNumeric({day:1,month:selMonth.value,year:yr}),inputId)},_priv._setOptionsYears=function(dmyCal,inputId){var html="",i=0,selYear=document.getElementById(ID_PREFIXES.selectedYear+inputId);for(dmyCal.year=parseInt(dmyCal.year,10),selYear=selYear?parseInt(selYear.value,10):dmyCal.year,html+="<ul>";10>i;)html+='<li class="',i%2===0&&(html+="newLine"),dmyCal.year-(5-i)===selYear&&(html+=" selected"),html+=_priv._validateMinMaxRange({day:0,month:0,year:dmyCal.year-(5-i)},inputId)?'"><a href="#" title="'+(dmyCal.year-(5-i))+'" tabindex="1">'+(dmyCal.year-(5-i))+"</a>":'"><span class="disabled">'+(dmyCal.year-(5-i))+"</span>",html+=0===i?'<input type="hidden" id="startOptYr_'+inputId+'" value="'+(dmyCal.year-(5-i))+'"></li>':9===i?'<input type="hidden" id="endOptYr_'+inputId+'" value="'+(dmyCal.year-(5-i))+'"></li>':"</li>",i+=1;return html+=_priv._validateMinMaxRange({day:0,month:0,year:dmyCal.year-6},inputId)?'<li class="newLine"><a href="#" class="fastNavPrevYrs" title="Previous years" tabindex="1"><img src="'+_imgPath+'CalendarPreviousQuarter.png" alt="Previous years"></a></li>':'<li class="newLine"><span class="grayedOut"><img src="'+_imgPath+'CalendarPreviousQuarter.png" alt="Previous years"></span></li>',html+=_priv._validateMinMaxRange({day:0,month:0,year:dmyCal.year+5},inputId)?'<li><a href="#" class="fastNavNextYrs" title="Next years" tabindex="1"><img src="'+_imgPath+'CalendarNextQuarter.png" alt="Next years"></a></li>':'<li><span class="grayedOut"><img src="'+_imgPath+'CalendarNextQuarter.png" alt="Next years"></span></li>',html+='</ul><input type="hidden" id="selYr_'+inputId+'" value="'+selYear.toString()+'">'},_priv._setOptionsMonths=function(dmyCal,inputId){var html="",i=0,selMonth=document.getElementById(ID_PREFIXES.selectedMonth+inputId);for(selMonth=selMonth?parseInt(selMonth.value,10):dmyCal.month,html+="<ul>";12>i;)html+='<li class="',i%2===0&&(html+="newLine"),i+1===selMonth&&(html+=" selected"),html+=_priv._validateMinMaxRange({day:1,month:i+1,year:dmyCal.year},inputId)||_priv._validateMinMaxRange({day:_priv._getLastDayOfMonth(new Date(i+1+"/01/"+dmyCal.year)),month:i+1,year:dmyCal.year},inputId)?'"><a href="#" title="'+MONTH_EN[i]+'" tabindex="1">'+MSHORT_EN[i]+"</a></li>":'"><span class="disabled">'+MSHORT_EN[i]+"</span></li>",i+=1;return html+='</ul><input type="hidden" id="selMon_'+inputId+'" value="'+selMonth.toString()+'">'},_priv._positionOptions=function(elem,option){option.style.left=parseInt(elem.offsetLeft+elem.clientWidth/2,10)+"px",option.style.top=elem.clientHeight+"px"},_priv._showOptions=function(opts){$(opts).removeClass(CLASSES.hidden)},_priv._hideOptions=function(opts){$(opts).addClass(CLASSES.hidden)},_priv._handleBoundaryDetection=function(elem){var bodyElem=document.body,scrollLeft=bodyElem.scrollLeft,scrollTop=bodyElem.scrollTop,viewportHeight=window.innerHeight||document.body.parentElement.offsetHeight;0===scrollTop&&0!==bodyElem.parentElement.scrollTop&&(scrollTop=bodyElem.parentElement.scrollTop),0===scrollLeft&&0!==bodyElem.parentElement.scrollLeft&&(scrollLeft=bodyElem.parentElement.scrollLeft),viewportHeight-(elem.parentNode.offsetTop+1)-(elem.offsetTop-scrollTop)-20<elem.clientHeight&&window.scrollBy(0,elem.clientHeight-(viewportHeight-(elem.parentNode.offsetTop+1)-(elem.offsetTop-scrollTop)-20)),bodyElem.clientWidth-(elem.offsetLeft+elem.parentNode.offsetLeft)+scrollLeft-5<elem.clientWidth&&window.scrollBy(elem.clientWidth-(bodyElem.clientWidth-(elem.offsetLeft+elem.parentNode.offsetLeft)+scrollLeft)+5,0),scrollLeft-elem.offsetLeft-elem.parentNode.offsetLeft+5>0&&window.scrollBy(-1*(scrollLeft-elem.offsetLeft-elem.parentNode.offsetLeft+5),0)},_priv._getMonthValFromLongStr=function(monthStr){for(var i=MONTH_EN.length;(i-=1)>=0;)if(monthStr===MONTH_EN[i]){i+=1;break}return i},_priv._getMonthValFromShortStr=function(monthStr){for(var i=MSHORT_EN.length;(i-=1)>=0;)if(monthStr===MSHORT_EN[i]){i+=1;break}return i},_priv._getMonthYearFromCalHeader=function(cal){var monthYear=$(cal).find("a.monthYear").get(0),splitMonYr=monthYear.innerHTML.split(" "),mon=_priv._getMonthValFromLongStr(splitMonYr[0]),yr=splitMonYr[1];return[mon,yr]},_priv._getLastDayOfMonth=function(date){var mon=date.getMonth()+1,lastDayMonth=0,dateTest=null;return lastDayMonth=DAYS_MON[mon-1],2===mon&&(dateTest=new Date("02/29/"+date.getFullYear()),dateTest.getMonth()+1===mon&&(lastDayMonth+=1)),lastDayMonth},_priv._getDatePickerInitialDate=function(inputId){var input=document.getElementById(inputId),__buildCalDate=function(dateParsed){var date=null;return date=dateParsed.valid?new Date(dateParsed.dmy.month+"/"+dateParsed.dmy.day+"/"+dateParsed.dmy.year):new Date,{day:date.getDate(),month:date.getMonth()+1,year:date.getFullYear()}};return input?__buildCalDate(_priv._processDate($.trim(input.value),inputId)):void 0},_priv._getFormattedDate=function(dateStr,inputId){var dateParsed={};return dateParsed=_priv._processDate($.trim(dateStr),inputId),dateParsed.valid?dateParsed.stringValue:null},_priv._processDate=function(dateStr,inputId){var dateParsed={valid:!1,dmy:{},stringValue:""},splitDate={},dateTest=null,settings=_priv._getSettings(inputId);return dateParsed.stringValue=dateStr,splitDate=_priv._getDateFromCulture(dateStr,inputId),dateParsed.dmy=splitDate.dmy,dateParsed.stringValue=splitDate.ordered[0]+CULTURES[settings.culture].delim+splitDate.ordered[1]+CULTURES[settings.culture].delim+splitDate.ordered[2],dateStr=dateParsed.stringValue,dateStr.length===CULTURES[settings.culture].mask.length&&(dateTest=new Date(dateParsed.dmy.month+"/"+dateParsed.dmy.day+"/"+dateParsed.dmy.year),parseInt(dateParsed.dmy.month,10)===dateTest.getMonth()+1&&(dateParsed.valid=_priv._validateMinMaxRange(_priv._convertDMYToNumeric(dateParsed.dmy),inputId))),dateParsed},_priv._convertDMYToNumeric=function(dmy){return{day:parseInt(dmy.day,10),month:parseInt(dmy.month,10),year:parseInt(dmy.year,10)}},_priv._validateMinMaxRange=function(dmyCal,inputId){var settings=_priv._getSettings(inputId),minDate=_priv._parseDateStringToDateObject(settings.minDate,inputId),maxDate=_priv._parseDateStringToDateObject(settings.maxDate,inputId),dateTest=null;if(0===dmyCal.day&&0===dmyCal.month){if(dmyCal.year>=minDate.getFullYear()&&dmyCal.year<=maxDate.getFullYear())return!0}else if(dateTest=new Date(dmyCal.month+"/"+dmyCal.day+"/"+dmyCal.year),dateTest>=minDate&&maxDate>=dateTest)return!0;return!1},_priv._getDateFromCulture=function(dateStr,inputId){var dateParsed={dmy:{day:"",month:"",year:""},ordered:[]},day="",mon="",yr="",settings=_priv._getSettings(inputId),dateSplit=dateStr.split(CULTURES[settings.culture].delim),maskSplit=CULTURES[settings.culture].mask.split("|"),i=dateSplit.length,j=0;if(i===maskSplit.length)for(;i>j;){switch(maskSplit[j]){case"DD":day=parseInt(dateSplit[j],10),isNaN(day)||(dateParsed.dmy.day=10>day?"0"+day:day.toString(),dateParsed.ordered[j]=dateParsed.dmy.day);break;case"MM":mon=parseInt(dateSplit[j],10),isNaN(mon)||(dateParsed.dmy.month=10>mon?"0"+mon:mon.toString(),dateParsed.ordered[j]=dateParsed.dmy.month);break;case"YYYY":yr=parseInt(dateSplit[j],10),isNaN(yr)||(dateParsed.dmy.year=yr.toString(),dateParsed.ordered[j]=dateParsed.dmy.year)}j+=1}return dateParsed},_priv._parseDateStringToDateObject=function(dateStr,inputId){var dateDMY=_priv._getDateFromCulture(dateStr,inputId);return new Date(dateDMY.dmy.month+"/"+dateDMY.dmy.day+"/"+dateDMY.dmy.year)},_priv._setDateToCulture=function(dmyCal,inputId,culture){return"undefined"==typeof culture?_priv._setDateToSelectedCulture(dmyCal,inputId,CULTURES[_priv._getSettings(inputId).culture]):_priv._setDateToSelectedCulture(dmyCal,inputId,culture)},_priv._setDateToSelectedCulture=function(dmyCal,inputId,culture){for(var maskSplit=culture.mask.split("|"),i=maskSplit.length,j=0,dateStr="";i>j;){switch(maskSplit[j]){case"DD":dateStr+=dmyCal.day.toString()+culture.delim;break;case"MM":dateStr+=dmyCal.month.toString()+culture.delim;break;case"YYYY":dateStr+=dmyCal.year.toString()+culture.delim}j+=1}return dateStr.substring(0,dateStr.length-1)},_priv._runOptionsActions=function(elem,opts,cal){for(var actions=$(opts).find("a"),i=actions.length,j=0;i>j;){if(actions.get(j)===elem){switch(j){case 0:_priv._runOptionsToday(cal);break;case 1:_priv._runOptionsOK(cal);break;case 2:_priv._runOptionsClose(cal)}break}j+=1}},_priv._runOptionsToday=function(cal){_priv._setSelectedDate(null,cal)},_priv._runOptionsOK=function(cal){var inputId=cal.id.substring(cal.id.indexOf(ID_PREFIXES.datePicker+"_")+(ID_PREFIXES.datePicker.length+1)),selMonth=document.getElementById(ID_PREFIXES.selectedMonth+inputId),selYear=document.getElementById(ID_PREFIXES.selectedYear+inputId),settings=_priv._getSettings(inputId),minDate=_priv._parseDateStringToDateObject(settings.minDate,inputId),maxDate=_priv._parseDateStringToDateObject(settings.maxDate,inputId),dateTest=new Date(selMonth.value+"/01/"+selYear.value);_priv._validateMinMaxRange(_priv._convertDMYToNumeric({day:1,month:selMonth.value,year:selYear.value}),inputId)||(minDate>dateTest?selMonth.value=minDate.getMonth()+1:dateTest>maxDate&&(selMonth.value=maxDate.getMonth()+1)),cal.innerHTML=_priv._getDatePickerHtml(_priv._convertDMYToNumeric({day:1,month:selMonth.value,year:selYear.value}),inputId),_priv._runOptionsClose(cal)},_priv._runOptionsClose=function(cal){_priv._showHideOptions($(cal).find("a.monthYear").get(0),document.getElementById("dpOptions_"+cal.id.substring(cal.id.indexOf(ID_PREFIXES.datePicker+"_")+(ID_PREFIXES.datePicker.length+1))),!0)},_priv._getSelectedDate=function(elem,cal){var $parent,dmyCal={},inputId="",hidden=null,splitHdn=[],todaysDate=new Date;return elem?(inputId=cal.id.substring(cal.id.indexOf(ID_PREFIXES.datePicker+"_")+(ID_PREFIXES.datePicker.length+1)),hidden=document.getElementById("dpSel_"+inputId),splitHdn=hidden.value.split("/"),dmyCal={day:parseInt(elem.innerHTML,10),month:parseInt(splitHdn[0],10),year:parseInt(splitHdn[1],10)},$parent=$(elem.parentNode),$parent.hasClass("prevMonthDay")?(dmyCal.month-=1,dmyCal.month<1&&(dmyCal.month=12,dmyCal.year-=1)):$parent.hasClass("nextMonthDay")&&(dmyCal.month+=1,dmyCal.month>12&&(dmyCal.month=1,dmyCal.year+=1))):dmyCal={day:todaysDate.getDate(),month:todaysDate.getMonth()+1,year:todaysDate.getFullYear()},dmyCal},_priv._setSelectedDate=function(elem,cal){var inputId=cal.id.substring(cal.id.indexOf(ID_PREFIXES.datePicker+"_")+(ID_PREFIXES.datePicker.length+1)),input=document.getElementById(inputId),dmyCal=_priv._getSelectedDate(elem,cal),settings=_priv._getSettings(inputId);input.value=_priv._getFormattedDate(_priv._setDateToCulture(dmyCal,inputId),inputId),settings.display.autoError&&_priv._removeInlineError(input),_priv._hideDatePicker(cal),$("#"+ID_PREFIXES.calIcon+inputId).focus()},_priv._handleCalHeaderNavigation=function(elem,cal){var inputId=cal.id.substring(cal.id.indexOf(ID_PREFIXES.datePicker+"_")+(ID_PREFIXES.datePicker.length+1)),monthYear=_priv._getMonthYearFromCalHeader(cal),dmyCal={day:1,month:monthYear[0],year:monthYear[1]},settings=_priv._getSettings(inputId),minDate=_priv._parseDateStringToDateObject(settings.minDate,inputId),maxDate=_priv._parseDateStringToDateObject(settings.maxDate,inputId),minDateMonth=minDate.getMonth()+1,maxDateMonth=maxDate.getMonth()+1,minDateYear=minDate.getFullYear(),maxDateYear=maxDate.getFullYear(),className="";switch(className="string"==typeof elem?elem:elem.className){case"fastNavPrevQtr":(dmyCal.month!==minDateMonth||dmyCal.year!==minDateYear)&&(dmyCal.day=_priv._getLastDayOfMonth(new Date("01/"+monthYear[0]+"/"+monthYear[1])),dmyCal=_priv._previousQuarter(_priv._convertDMYToNumeric(dmyCal)),_priv._validateMinMaxRange(dmyCal,inputId)?(cal.innerHTML=_priv._getDatePickerHtml(dmyCal,inputId),cal.innerHTML.indexOf(elem.className)>-1?$(cal).find("a."+elem.className).focus():$(cal).find("a.monthYear").focus()):(dmyCal.month<minDateMonth||dmyCal.year<minDateYear)&&(dmyCal.month=minDateMonth,dmyCal.year=minDateYear,cal.innerHTML=_priv._getDatePickerHtml(dmyCal,inputId),cal.innerHTML.indexOf(elem.className)>-1?$(cal).find("a."+elem.className).focus():$(cal).find("a.monthYear").focus()));break;case"navPrevMon":(dmyCal.month!==minDateMonth||dmyCal.year!==minDateYear)&&(dmyCal.day=_priv._getLastDayOfMonth(new Date("01/"+monthYear[0]+"/"+monthYear[1])),dmyCal=_priv._previousMonth(_priv._convertDMYToNumeric(dmyCal)),_priv._validateMinMaxRange(dmyCal,inputId)&&(cal.innerHTML=_priv._getDatePickerHtml(dmyCal,inputId),cal.innerHTML.indexOf(elem.className)>-1?$(cal).find("a."+elem.className).focus():$(cal).find("a.monthYear").focus()));break;case"navNextMon":(dmyCal.month!==maxDateMonth||dmyCal.year!==maxDateYear)&&(dmyCal=_priv._nextMonth(_priv._convertDMYToNumeric(dmyCal)),_priv._validateMinMaxRange(dmyCal,inputId)&&(cal.innerHTML=_priv._getDatePickerHtml(dmyCal,inputId),cal.innerHTML.indexOf(elem.className)>-1?$(cal).find("a."+elem.className).focus():$(cal).find("a.monthYear").focus()));break;case"fastNavNextQtr":(dmyCal.month!==maxDateMonth||dmyCal.year!==maxDateYear)&&(dmyCal=_priv._nextQuarter(_priv._convertDMYToNumeric(dmyCal)),_priv._validateMinMaxRange(dmyCal,inputId)?(cal.innerHTML=_priv._getDatePickerHtml(dmyCal,inputId),cal.innerHTML.indexOf(elem.className)>-1?$(cal).find("a."+elem.className).focus():$(cal).find("a.monthYear").focus()):(dmyCal.month>maxDateMonth||dmyCal.year>maxDate.getFullYear())&&(dmyCal.month=maxDateMonth,dmyCal.year=maxDateYear,cal.innerHTML=_priv._getDatePickerHtml(dmyCal,inputId),cal.innerHTML.indexOf(elem.className)>-1?$(cal).find("a."+elem.className).focus():$(cal).find("a.monthYear").focus()));break;case"navPrevYear":(dmyCal.month!==maxDateMonth||dmyCal.year!==maxDateYear)&&(dmyCal.day=_priv._getLastDayOfMonth(new Date("01/"+monthYear[0]+"/"+monthYear[1])),dmyCal=_priv._previousYear(_priv._convertDMYToNumeric(dmyCal)),_priv._validateMinMaxRange(dmyCal,inputId)&&(cal.innerHTML=_priv._getDatePickerHtml(dmyCal,inputId)));break;case"navNextYear":(dmyCal.month!==maxDateMonth||dmyCal.year!==maxDateYear)&&(dmyCal=_priv._nextYear(_priv._convertDMYToNumeric(dmyCal)),_priv._validateMinMaxRange(dmyCal,inputId)&&(cal.innerHTML=_priv._getDatePickerHtml(dmyCal,inputId)))}},_priv._handleOptionsNavigation=function(elem,cal){var inputId=cal.id.substring(cal.id.indexOf(ID_PREFIXES.datePicker+"_")+(ID_PREFIXES.datePicker.length+1)),startOptYr=parseInt(document.getElementById("startOptYr_"+inputId).value,10),endOptYr=parseInt(document.getElementById("endOptYr_"+inputId).value,10),selYear=parseInt(document.getElementById(ID_PREFIXES.selectedYear+inputId).value,10),divMonths=$("#dpOptions_"+inputId).find("div.dpMon").get(0),divYears=$("#dpOptions_"+inputId).find("div.dpYr").get(0),settings=_priv._getSettings(inputId),minDate=_priv._parseDateStringToDateObject(settings.minDate,inputId),maxDate=_priv._parseDateStringToDateObject(settings.maxDate,inputId);switch(elem.className){case"fastNavPrevYrs":_priv._validateMinMaxRange({day:31,month:12,year:startOptYr-1},inputId)&&(divYears.innerHTML=_priv._setOptionsYears({day:1,month:1,year:startOptYr-5},inputId),divMonths.innerHTML=selYear>=startOptYr-10&&startOptYr>selYear?_priv._setOptionsMonths({day:31,month:12,year:selYear},inputId):_priv._setOptionsMonths({day:31,month:12,year:startOptYr-1},inputId),minDate.getFullYear()<startOptYr-10?$(cal).find("a."+elem.className).focus():$(cal).find("a.fastNavNextYrs").focus());break;case"fastNavNextYrs":_priv._validateMinMaxRange({day:1,month:1,year:endOptYr+1},inputId)&&(divYears.innerHTML=_priv._setOptionsYears({day:1,month:1,year:endOptYr+6},inputId),divMonths.innerHTML=selYear>endOptYr&&endOptYr+10>=selYear?_priv._setOptionsMonths({day:1,month:1,year:selYear},inputId):_priv._setOptionsMonths({day:1,month:1,year:endOptYr+1},inputId),maxDate.getFullYear()>endOptYr+10?$(cal).find("a."+elem.className).focus():$(cal).find("a.fastNavPrevYrs").focus())}},_priv._previousQuarter=function(dmyCal){return dmyCal.month+=-3,_priv._recalculateDMY(dmyCal)},_priv._previousMonth=function(dmyCal){return dmyCal.month+=-1,_priv._recalculateDMY(dmyCal)},_priv._nextMonth=function(dmyCal){return dmyCal.month+=1,_priv._recalculateDMY(dmyCal)},_priv._nextQuarter=function(dmyCal){return dmyCal.month+=3,_priv._recalculateDMY(dmyCal)},_priv._previousYear=function(dmyCal){return dmyCal.month+=-12,_priv._recalculateDMY(dmyCal)},_priv._nextYear=function(dmyCal){return dmyCal.month+=12,_priv._recalculateDMY(dmyCal)},_priv._recalculateDMY=function(dmyCal){return dmyCal.month<=0?(dmyCal.month+=12,dmyCal.year-=1):dmyCal.month>12&&(dmyCal.month-=12,dmyCal.year+=1),dmyCal},_priv._showInlineError=function(elem){$(elem).addClass(CLASSES.invalidDate)},_priv._removeInlineError=function(elem){$(elem).removeClass(CLASSES.invalidDate)},_priv._forceOptionsOK=function(cal){var inputId=cal.id.substring(cal.id.indexOf(ID_PREFIXES.datePicker+"_")+(ID_PREFIXES.datePicker.length+1)),okBtn=document.getElementById("dpOK_"+inputId),opts=document.getElementById("dpOther_"+inputId);_priv._runOptionsActions(okBtn,opts,cal)},_events._iconClick=function(ev){var target=ev.target,iconId=target.id.substring(target.id.indexOf(ID_PREFIXES.calIcon)+ID_PREFIXES.calIcon.length),cal=document.getElementById(ID_PREFIXES.datePicker+iconId);_priv._hideAllDatePickers(iconId),_priv._showHideDatePicker(target,cal)},_events._inputBlur=function(ev){var input=ev.target,dateParsed=null,settings=_priv._getSettings(input.id);input&&($.trim(input.value).length>0?(dateParsed=_priv._getFormattedDate(input.value,input.id),dateParsed?(input.value=dateParsed,settings.display.autoError&&_priv._removeInlineError(input)):settings.display.autoError&&_priv._showInlineError(input)):settings.display.autoError&&_priv._removeInlineError(input))},_events._calClick=function(ev){for(var icon=ev.target,parent=icon,clickElem=null,clickParent=null;parent.id.indexOf(ID_PREFIXES.datePicker)<0;)"A"===parent.nodeName&&(clickElem=parent),parent=parent.parentNode;if(clickElem)switch(ev.stopPropagation(),clickElem.className){case"fastNavPrevQtr":case"navPrevMon":case"navNextMon":case"fastNavNextQtr":_priv._handleCalHeaderNavigation(clickElem,parent);break;case"monthYear":_priv._showHideOptions(clickElem,document.getElementById("dpOptions_"+parent.id.substring(parent.id.indexOf(ID_PREFIXES.datePicker+"_")+(ID_PREFIXES.datePicker.length+1))));break;case"fastNavPrevYrs":case"fastNavNextYrs":_priv._handleOptionsNavigation(clickElem,parent);break;default:for(clickParent=clickElem;clickParent!==parent&&"BODY"!==clickParent.nodeName;){if("dpMon"===clickParent.className){_priv._setOptionsSelectedMonth(clickElem,clickParent,parent),"dblclick"===ev.type&&_priv._forceOptionsOK(parent);
break}if("dpYr"===clickParent.className){_priv._setOptionsSelectedYear(clickElem,clickParent,parent),"dblclick"===ev.type&&_priv._forceOptionsOK(parent);break}if("dpOther"===clickParent.className){_priv._runOptionsActions(clickElem,clickParent,parent);break}if("dpDays"===clickParent.className){_priv._setSelectedDate(clickElem,parent);break}clickParent=clickParent.parentNode}}},_events._calKeydown=function(ev){var elem=ev.target,parentId=$(elem).closest(".dp").attr("id"),inputId=parentId.substring(parentId.indexOf(ID_PREFIXES.datePicker+"_")+(ID_PREFIXES.datePicker.length+1)),$dpOptions=$("#dpOptions_"+inputId),$calIcon=$("#"+ID_PREFIXES.calIcon+inputId),calIcon=$calIcon.get(0),$cal=$("#"+ID_PREFIXES.datePicker+inputId),cal=$cal.get(0),linksCal=[],linksOpts=[];switch(ev.keyCode){case 27:_priv._showHideDatePicker(calIcon,cal,!0);break;case 9:linksCal=$("#dpCalWrap_"+inputId).find("a"),linksOpts=$dpOptions.find("a"),(elem.id==="dpCalWrap_"+inputId&&ev.shiftKey||linksCal[linksCal.length-1]===elem&&!ev.shiftKey)&&(_priv._hideDatePicker(cal),$calIcon.focus()),(elem.id==="dpOptions_"+inputId&&ev.shiftKey||linksOpts[linksOpts.length-1]===elem&&!ev.shiftKey)&&_priv._runOptionsClose(cal);break;case 37:$dpOptions.hasClass(CLASSES.hidden)&&_priv._handleCalHeaderNavigation($cal.find(".navPrevMon").get(0),cal);break;case 39:$dpOptions.hasClass(CLASSES.hidden)&&_priv._handleCalHeaderNavigation($cal.find(".navNextMon").get(0),cal);break;case 38:$dpOptions.hasClass(CLASSES.hidden)&&(_priv._handleCalHeaderNavigation("navNextYear",cal),$cal.find("a.monthYear").focus());break;case 40:$dpOptions.hasClass(CLASSES.hidden)&&(_priv._handleCalHeaderNavigation("navPrevYear",cal),$cal.find("a.monthYear").focus())}},_events._bodyClick=function(ev){var $target=$(ev.target),$parent=$target.closest(SELECTORS.icon+", .dp, .dpCalWrap, .dpOptWrap");$parent.length||_priv._hideAllDatePickers()},_events._windowResize=function(){$("div.dp:not(.hidden)").each(function(){_priv._setDatePickerPosition(this)})},$(document).ready(_init),{init:_init,setImagesPath:_setImagesPath,customize:_customize,hideAll:_hideAll}}(),cui.datepicker=cui.component.datepicker;
//# sourceMappingURL=datepicker.js.map